<!DOCTYPE html>
<html lang="ko" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kubernetes AI Workflow Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    body { font-family: 'Pretendard', -apple-system, sans-serif; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    const WorkflowDashboard = () => {
      const [workflowData, setWorkflowData] = useState(null);
      const [selectedStage, setSelectedStage] = useState(null);
      const [activeTab, setActiveTab] = useState('timeline');
      const [loading, setLoading] = useState(true);
      const [error, setError] = useState(null);

      const taskId = window.location.pathname.split('/').pop();

      const mapStatusToStage = (task) => {
        const history = task.history || [];
        const payload = task.payload || {};
        const podName = payload.pod_name || 'unknown';
        const namespace = payload.namespace || 'unknown';

        const baseStages = [
          { id: 'detection', name: '문제 감지', icon: 'activity', status: 'completed', timestamp: task.received_at?.slice(11,19) || '--', duration: '--' },
          { id: 'buffering', name: '이벤트 수집', icon: 'clock', status: 'completed', timestamp: '--', duration: '--' },
        ];

        const statusMap = {
          analyzing_initial: { name: "AI 초기 분석", icon: 'cpu', status: "completed" },
          executing_read_commands: { name: "정보 수집", icon: 'eye', status: "completed" },
          searching_rag: { name: "지식 검색", icon: 'database', status: "completed" },
          analyzing_final: { name: "최종 분석", icon: 'cpu', status: "completed" },
          awaiting_approval: { name: "승인 대기", icon: 'shield-alert', status: "in_progress" },
          executing_write_commands: { name: "문제 해결 실행", icon: 'edit-3', status: "completed" },
          resolved: { name: "해결 완료", icon: 'check-circle', status: "completed" },
          auto_approved: { name: "자동 승인 후 해결", icon: 'check-circle-2', status: "completed" },
          failed: { name: "실패", icon: 'x-circle', status: "error" },
        };

        history.forEach(h => {
          const step = h.step;
          if (statusMap[step]) {
            baseStages.push({
              id: step,
              name: statusMap[step].name,
              icon: statusMap[step].icon,
              status: task.status.startsWith('failed') ? 'error' :
                     (task.status === 'awaiting_approval' && step === 'awaiting_approval' ? 'in_progress' : 'completed'),
              timestamp: h.timestamp?.slice(11,19) || '--',
              duration: '--'
            });
          }
        });

        return {
          taskId: task.task_id || taskId,
          podName,
          namespace,
          finalStatus: task.status || 'unknown',
          totalDuration: '--',
          summary: {
            problem: payload.event_type || 'Unknown',
            solution: task.final_commands ? 'AI 제안 명령 실행' : '분석 중',
            approver: '운영팀',
            riskyCommands: task.final_commands?.is_risky || false,
          },
          payload: task.payload,              // 원본 payload 보관
          read_logs: task.read_logs || [],    // kubectl logs/describe 결과
          final_logs: task.final_logs || [],  // 쓰기 명령 실행 결과
          ragResults: task.rag_results ? task.rag_results.map((r, i) => ({
            id: `doc-${i}`,
            title: r.title || '문서',
            snippet: r.content || '내용 없음',
            found: true
          })) : [{
            id: 'doc-1',
            title: '관련 문서 없음',
            snippet: 'AI가 자체 지식으로 해결을 시도합니다.',
            found: false
          }],
          commands: {
            read: (task.initial_commands?.command_list || []).map(c => ({ cmd: c, time: '--', duration: '--' })),
            write: (task.final_commands?.command_list || []).map(c => ({ cmd: c, time: '--', duration: '--', approved: task.status.includes('approved') || task.status === 'resolved' || task.status === 'auto_approved' }))
          },
          history: task.history || [],
          llmCalls: [
            task.initial_commands && {
              stage: 'Initial Analysis',
              model: 'GPT-4o',
              time: '--',
              duration: '--',
              purpose: '문제 진단 및 정보 수집 계획',
              input: 'Pod 이벤트 분석',
              output: `${(task.initial_commands?.command_list || []).length}개 읽기 명령 생성`,
              tokens: { input: 1200, output: 150 }
            },
            task.final_commands && {
              stage: 'Final Analysis',
              model: 'GPT-4o',
              time: '--',
              duration: '--',
              purpose: '최종 해결 방안 결정',
              input: '로그 + RAG + 상태',
              output: `${(task.final_commands?.command_list || []).length}개 명령 생성`,
              tokens: { input: 2800, output: 100 }
            }
          ].filter(Boolean),
          stages: baseStages
        };
      };

      useEffect(() => {
        const fetchTask = async () => {
          try {
            const res = await fetch(`/tasks/${taskId}`);
            if (!res.ok) {
              throw new Error(`Task not found (HTTP ${res.status})`);
            }
            const task = await res.json();
            setWorkflowData(mapStatusToStage(task));
            setError(null);
          } catch (err) {
            console.error("Failed to fetch task:", err);
            setError(err.message || "태스크를 불러오지 못했습니다.");
          } finally {
            setLoading(false);
          }
        };

        if (taskId && taskId !== '') {
          fetchTask();
          const interval = setInterval(fetchTask, 3000);
          return () => clearInterval(interval);
        } else {
          setError("유효하지 않은 Task ID입니다.");
          setLoading(false);
        }
      }, [taskId]);

      const getStatusColor = (status) => {
        if (status === 'completed') return 'bg-green-500';
        if (status === 'in_progress') return 'bg-blue-500 animate-pulse';
        if (status === 'error') return 'bg-red-500';
        return 'bg-gray-500';
      };

      if (loading) return (
        <div className="flex items-center justify-center h-screen">
          <i className="lucide lucide-activity w-12 h-12 animate-spin text-blue-400"></i>
          <span className="ml-4 text-xl">태스크 정보를 불러오는 중...</span>
        </div>
      );

      if (error) return (
        <div className="flex items-center justify-center h-screen text-red-400">
          <i className="lucide lucide-alert-circle w-12 h-12 mr-4"></i>
          <span className="text-xl">Error: {error}</span>
        </div>
      );

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6">
          <div className="max-w-[1800px] mx-auto">
            <div className="mb-6">
              <h1 className="text-3xl font-bold text-white mb-2">Kubernetes AI Workflow Dashboard</h1>
              <div className="flex items-center gap-4 text-slate-300 text-sm">
                <span>Task: <span className="font-mono text-blue-400">{workflowData.taskId}</span></span>
                <span>•</span>
                <span>Status: <span className={workflowData.finalStatus.includes('resolved') || workflowData.finalStatus === 'auto_approved' ? 'text-green-400' : 'text-yellow-400'}>{workflowData.finalStatus}</span></span>
              </div>
            </div>

            <div className="grid grid-cols-6 gap-4 mb-6">
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-terminal w-4 h-4 text-blue-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">대상 Pod</h3>
                </div>
                <p className="text-lg font-bold text-white">{workflowData.podName}</p>
                <p className="text-xs text-slate-400">{workflowData.namespace}</p>
              </div>
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-check-circle w-4 h-4 text-green-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">최종 상태</h3>
                </div>
                <p className="text-lg font-bold text-green-400">{workflowData.finalStatus}</p>
              </div>
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-eye w-4 h-4 text-blue-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">읽기 명령</h3>
                </div>
                <p className="text-2xl font-bold text-white">{workflowData.commands.read.length}</p>
              </div>
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-edit-3 w-4 h-4 text-orange-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">쓰기 명령</h3>
                </div>
                <p className="text-2xl font-bold text-white">{workflowData.commands.write.length}</p>
              </div>
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-user w-4 h-4 text-purple-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">승인자</h3>
                </div>
                <p className="text-sm font-bold text-white">{workflowData.summary.approver}</p>
              </div>
              <div className="bg-slate-800/50 backdrop-blur rounded-xl p-4 border border-slate-700">
                <div className="flex items-center gap-2 mb-2">
                  <i className="lucide lucide-cpu w-4 h-4 text-cyan-400"></i>
                  <h3 className="text-xs font-semibold text-slate-400">AI 모델</h3>
                </div>
                <p className="text-lg font-bold text-white">GPT-4o</p>
              </div>
            </div>

            <div className="bg-slate-800/50 backdrop-blur rounded-2xl border border-slate-700 overflow-hidden">
              <div className="flex border-b border-slate-700">
                <button onClick={() => setActiveTab('timeline')} className={`px-6 py-3 font-medium transition-colors ${activeTab === 'timeline' ? 'bg-blue-500/20 text-blue-400 border-b-2 border-blue-400' : 'text-slate-400 hover:text-white'}`}>타임라인</button>
                <button onClick={() => setActiveTab('commands')} className={`px-6 py-3 font-medium transition-colors ${activeTab === 'commands' ? 'bg-blue-500/20 text-blue-400 border-b-2 border-blue-400' : 'text-slate-400 hover:text-white'}`}>실행 명령어</button>
                <button onClick={() => setActiveTab('llm')} className={`px-6 py-3 font-medium transition-colors ${activeTab === 'llm' ? 'bg-blue-500/20 text-blue-400 border-b-2 border-blue-400' : 'text-slate-400 hover:text-white'}`}>AI 분석</button>
                <button onClick={() => setActiveTab('rag')} className={`px-6 py-3 font-medium transition-colors ${activeTab === 'rag' ? 'bg-blue-500/20 text-blue-400 border-b-2 border-blue-400' : 'text-slate-400 hover:text-white'}`}>지식베이스</button>
              </div>

              <div className="p-6">
                {activeTab === 'timeline' && (
                  <div className="grid grid-cols-12 gap-6">
                    <div className="col-span-5">
                      <div className="space-y-4">
                        {workflowData.stages.map((stage, index) => {
                          const isSelected = selectedStage?.id === stage.id;
                          return (
                            <div key={stage.id} className="relative">
                              {index < workflowData.stages.length - 1 && (
                                <div className="absolute left-6 top-12 w-0.5 h-8 bg-slate-600"></div>
                              )}
                              <div
                                className={`relative cursor-pointer transition-all duration-300 ${isSelected ? 'scale-105' : 'hover:scale-102'}`}
                                onClick={() => setSelectedStage(stage)}
                              >
                                <div className={`bg-slate-700/50 rounded-xl p-4 border-2 ${isSelected ? 'border-blue-500 shadow-lg shadow-blue-500/20' : 'border-slate-600'}`}>
                                  <div className="flex items-center gap-3">
                                    <div className={`w-12 h-12 rounded-full ${getStatusColor(stage.status)} flex items-center justify-center text-white shadow-lg`}>
                                      {stage.status === 'completed' && <i className="lucide lucide-check w-6 h-6"></i>}
                                      {stage.status === 'error' && <i className="lucide lucide-x-circle w-6 h-6"></i>}
                                      {stage.status === 'in_progress' && <i className="lucide lucide-activity w-6 h-6 animate-spin"></i>}
                                      {(stage.status !== 'completed' && stage.status !== 'error' && stage.status !== 'in_progress') && (
                                        <i className={`lucide lucide-${stage.icon} w-6 h-6`}></i>
                                      )}
                                    </div>
                                    <div className="flex-1">
                                      <h3 className="font-semibold text-white">{stage.name}</h3>
                                      <p className="text-xs text-slate-400">{stage.timestamp} • {stage.duration}</p>
                                    </div>
                                  </div>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>

                    <div className="col-span-7">
                      {selectedStage ? (
                        <div>
                          <div className="mb-4">
                            <h2 className="text-xl font-semibold text-white">{selectedStage.name}</h2>
                            <p className="text-sm text-slate-400">
                              시작: {selectedStage.timestamp} | 소요: {selectedStage.duration}
                            </p>
                          </div>

                          {/* 단계별 동적 상세 내용 */}
                          {selectedStage.id === 'detection' && (
                            <div className="space-y-4">
                              <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-blue-400 mb-2">감지된 문제 요약</h3>
                                <p className="text-slate-200">
                                  Pod <span className="font-mono text-cyan-300">{workflowData.podName}</span> ({workflowData.namespace})에서 비정상 상태 감지
                                </p>
                                <p className="text-sm text-slate-400 mt-2">
                                  Event Type: {workflowData.payload?.event_type} • Phase: {workflowData.payload?.phase}
                                </p>
                              </div>
                              {workflowData.payload?.container_statuses && (
                                <div className="bg-slate-700/50 rounded-xl p-4">
                                  <h4 className="text-xs font-semibold text-slate-300 mb-2">최근 컨테이너 상태</h4>
                                  <pre className="text-xs text-slate-400 overflow-x-auto">
                                    {workflowData.payload.container_statuses.slice(-1)[0]?.state_summary || '정보 없음'}
                                  </pre>
                                </div>
                              )}
                            </div>
                          )}

                          {selectedStage.id === 'executing_read_commands' && (
                            <div className="space-y-4">
                              <div className="bg-blue-500/10 border border-blue-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-blue-400 mb-3">수집된 진단 정보</h3>
                                {workflowData.read_logs?.length > 0 ? (
                                  workflowData.read_logs.map((log, idx) => (
                                    <div key={idx} className="mb-4 last:mb-0">
                                      <div className="flex items-center gap-2 mb-2">
                                        <code className="text-xs bg-slate-900/70 px-2 py-1 rounded text-cyan-300">
                                          {log.command}
                                        </code>
                                        <span className={`text-xs px-2 py-1 rounded ${log.status === 'success' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'}`}>
                                          {log.status}
                                        </span>
                                      </div>
                                      <pre className="text-xs text-slate-300 bg-slate-900/50 p-3 rounded-lg overflow-x-auto max-h-60">
                                        {log.output || '출력 없음'}
                                      </pre>
                                    </div>
                                  ))
                                ) : (
                                  <p className="text-slate-400">수집된 로그가 없습니다.</p>
                                )}
                              </div>
                            </div>
                          )}

                          {selectedStage.id === 'searching_rag' && (
                            <div className="space-y-4">
                              <div className="bg-purple-500/10 border border-purple-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-purple-400 mb-3">검색된 지식 베이스 문서</h3>
                                {workflowData.ragResults.filter(r => r.found).length > 0 ? (
                                  workflowData.ragResults
                                    .filter(r => r.found)
                                    .map((doc, i) => (
                                      <div key={i} className="bg-slate-700/30 rounded-lg p-3 mb-3">
                                        <h4 className="text-sm font-medium text-white mb-1">{doc.title}</h4>
                                        <p className="text-xs text-slate-300">{doc.snippet}</p>
                                      </div>
                                    ))
                                ) : (
                                  <p className="text-slate-400">관련 문서가 발견되지 않아 AI가 자체 지식으로 분석을 진행했습니다.</p>
                                )}
                              </div>
                            </div>
                          )}

                          {['analyzing_initial', 'analyzing_final'].includes(selectedStage.id) && (
                            <div className="space-y-4">
                              <div className="bg-cyan-500/10 border border-cyan-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-cyan-400 mb-3">
                                  {selectedStage.id === 'analyzing_initial' ? '초기 문제 진단' : '최종 해결 방안 결정'}
                                </h3>
                                <p className="text-slate-200 mb-4">
                                  {selectedStage.id === 'analyzing_initial'
                                    ? 'AI가 이벤트와 로그를 분석하여 필요한 진단 명령을 생성했습니다.'
                                    : '수집된 모든 정보와 지식을 종합하여 최종 해결 명령을 제안했습니다.'}
                                </p>
                                <div className="grid grid-cols-2 gap-4">
                                  <div className="bg-slate-900/50 rounded-lg p-3">
                                    <p className="text-xs text-slate-400">주요 원인 추정</p>
                                    <p className="text-sm text-white mt-1">
                                      {workflowData.payload?.reasons?.join(', ') || '설정 오류 또는 비정상 종료'}
                                    </p>
                                  </div>
                                  <div className="bg-slate-900/50 rounded-lg p-3">
                                    <p className="text-xs text-slate-400">생성된 명령 수</p>
                                    <p className="text-sm text-green-400 mt-1 font-mono">
                                      {selectedStage.id === 'analyzing_initial'
                                        ? workflowData.commands.read.length
                                        : workflowData.commands.write.length}개
                                    </p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          )}

                          {selectedStage.id === 'awaiting_approval' && (
                            <div className="space-y-4">
                              <div className="bg-yellow-500/10 border border-yellow-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-yellow-400 mb-3">승인 대기 중</h3>
                                <p className="text-slate-200">
                                  위험한 쓰기 명령이 포함되어 있어 운영자의 승인이 필요합니다.
                                </p>
                                <div className="mt-4 space-y-2">
                                  {workflowData.commands.write.map((cmd, i) => (
                                    <code key={i} className="block text-sm bg-slate-900/70 px-3 py-2 rounded text-orange-300">
                                      {cmd.cmd}
                                    </code>
                                  ))}
                                </div>
                                <p className="text-xs text-slate-400 mt-4">
                                  승인자: {workflowData.history?.find(h => h.step === 'approval_received')?.reason || '대기 중'}
                                </p>
                              </div>
                            </div>
                          )}

                          {selectedStage.id === 'executing_write_commands' && (
                            <div className="space-y-4">
                              <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-4">
                                <h3 className="text-sm font-semibold text-green-400 mb-3">해결 명령 실행 결과</h3>
                                {workflowData.final_logs?.length > 0 ? (
                                  workflowData.final_logs.map((log, idx) => (
                                    <div key={idx} className="mb-3">
                                      <code className="text-xs bg-slate-900/70 px-2 py-1 rounded text-orange-300">
                                        {log.command}
                                      </code>
                                      <pre className="text-xs text-green-300 bg-slate-900/50 p-3 rounded mt-2">
                                        {log.output}
                                      </pre>
                                    </div>
                                  ))
                                ) : (
                                  <p className="text-slate-400">실행 기록 없음</p>
                                )}
                              </div>
                            </div>
                          )}

                          {selectedStage.id === 'resolved' && (
                            <div className="bg-green-500/10 border border-green-500/30 rounded-xl p-6 text-center">
                              <i className="lucide lucide-check-circle w-16 h-16 text-green-400 mx-auto mb-4"></i>
                              <h3 className="text-xl font-bold text-green-400">문제 해결 완료</h3>
                              <p className="text-slate-300 mt-3">
                                AI 워크플로우가 성공적으로 종료되었습니다.
                              </p>
                            </div>
                          )}

                          {/* 기타 단계 fallback */}
                          {![
                            'detection', 'executing_read_commands', 'searching_rag',
                            'analyzing_initial', 'analyzing_final', 'awaiting_approval',
                            'executing_write_commands', 'resolved'
                          ].includes(selectedStage.id) && (
                            <div className="bg-slate-700/30 border border-slate-600 rounded-xl p-6 text-center">
                              <p className="text-slate-400">이 단계에 대한 상세 정보가 아직 준비되지 않았습니다.</p>
                            </div>
                          )}
                        </div>
                      ) : (
                        <div className="h-full flex items-center justify-center text-slate-500">
                          <div className="text-center">
                            <i className="lucide lucide-activity w-16 h-16 mx-auto mb-4 opacity-30"></i>
                            <p className="text-lg">단계를 선택하여 상세 정보를 확인하세요</p>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {activeTab === 'commands' && (
                  <div className="space-y-6">
                    <div>
                      <div className="flex items-center gap-2 mb-4">
                        <i className="lucide lucide-eye w-5 h-5 text-blue-400"></i>
                        <h2 className="text-lg font-semibold text-white">읽기 명령어</h2>
                      </div>
                      <div className="space-y-3">
                        {workflowData.commands.read.map((cmd, idx) => (
                          <div key={idx} className="bg-slate-700/30 rounded-xl p-4 border border-slate-600">
                            <div className="bg-slate-900/50 rounded-lg p-3 font-mono text-sm text-cyan-300">{cmd.cmd}</div>
                            <p className="text-xs text-slate-400 mt-2">{cmd.time} • {cmd.duration}</p>
                          </div>
                        ))}
                      </div>
                    </div>
                    <div>
                      <div className="flex items-center gap-2 mb-4">
                        <i className="lucide lucide-edit-3 w-5 h-5 text-orange-400"></i>
                        <h2 className="text-lg font-semibold text-white">쓰기 명령어</h2>
                      </div>
                      <div className="space-y-3">
                        {workflowData.commands.write.map((cmd, idx) => (
                          <div key={idx} className="bg-red-500/5 rounded-xl p-4 border border-red-500/30">
                            <div className="bg-slate-900/50 rounded-lg p-3 font-mono text-sm text-orange-300">{cmd.cmd}</div>
                            <div className="mt-2 flex items-center justify-between">
                              <p className="text-xs text-slate-400">{cmd.time} • {cmd.duration}</p>
                              {cmd.approved && <span className="px-2 py-1 bg-green-500/20 text-green-400 text-xs rounded-full">승인됨</span>}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>
                  </div>
                )}

                {activeTab === 'llm' && (
                  <div className="space-y-4">
                    {workflowData.llmCalls.map((call, idx) => (
                      <div key={idx} className="bg-gradient-to-r from-cyan-500/10 to-blue-500/10 rounded-xl p-5 border border-cyan-500/30">
                        <div className="flex items-start justify-between mb-4">
                          <div>
                            <h3 className="text-lg font-semibold text-white">{call.stage}</h3>
                            <p className="text-sm text-cyan-400">{call.model}</p>
                          </div>
                          <p className="text-sm font-semibold text-green-400">{call.duration}</p>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                          <div className="bg-slate-900/50 rounded-lg p-3">
                            <p className="text-xs text-slate-400 mb-1">입력</p>
                            <p className="text-sm text-slate-300">{call.input}</p>
                            <p className="text-xs text-blue-400 mt-2">{call.tokens.input} 토큰</p>
                          </div>
                          <div className="bg-slate-900/50 rounded-lg p-3">
                            <p className="text-xs text-slate-400 mb-1">출력</p>
                            <p className="text-sm text-green-300">{call.output}</p>
                            <p className="text-xs text-green-400 mt-2">{call.tokens.output} 토큰</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}

                {activeTab === 'rag' && (
                  <div className="space-y-4">
                    {workflowData.ragResults.map((doc) => (
                      <div key={doc.id} className="bg-slate-700/30 rounded-xl p-4 border border-slate-600">
                        <h3 className="text-lg font-semibold text-white mb-2">{doc.title}</h3>
                        <p className="text-sm text-slate-300">{doc.snippet}</p>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(WorkflowDashboard));

    window.addEventListener('load', () => {
      if (typeof lucide !== 'undefined') {
        lucide.createIcons();
      }
    });
  </script>
</body>
</html>